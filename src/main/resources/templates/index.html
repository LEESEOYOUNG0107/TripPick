<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>TripPick AI</title>
    <style>
        /* modal header: 이미지가 full-width인 경우 버튼을 이미지 위에 절대 배치 */
        .modal-header { position: relative; }

        /* 버튼 위치: modal-header 내부에 절대 배치(필요시 left/right/top 값 조정) */
        .fav-btn {
            position: absolute;
            top: 12px;
            left: 12px;                 /* 왼쪽 상단에 위치시키려면 left 사용 */
            width: 44px;
            height: 44px;
            border-radius: 10px;
            border: none;
            background: rgba(255,255,255,0.94);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #64748b;             /* 기본(비활성) 색상 */
            z-index: 30;
            box-shadow: 0 6px 18px rgba(2,6,23,0.06);
            transition: transform .12s ease, background .12s ease, color .12s ease;
            padding: 0;
        }

        /* 터치 친화성 - 모바일에서 크기 확보 */
        @media (max-width: 480px) {
            .fav-btn { width: 50px; height: 50px; border-radius: 12px; top: 10px; left: 10px; }
        }

        /* 하트 경로(기본: 테두리만) */
        .fav-btn .heart-path {
            stroke: currentColor;
            stroke-width: 1.2;
            fill: none;
            transition: fill .18s ease, stroke .18s ease, transform .18s ease;
            transform-origin: center;
        }

        /* 호버 효과 */
        .fav-btn:hover { transform: scale(1.06); box-shadow: 0 10px 26px rgba(2,6,23,0.08); }

        /* 활성 상태(즐겨찾기 되어있음) */
        .fav-btn.active {
            background: linear-gradient(180deg, #fff0f0, #fff7f7);
            color: #ef4444;             /* 채운 하트 색상 */
        }

        /* 활성일 때 하트 채우기 + 펄스 애니메이션 */
        .fav-btn.active .heart-path {
            fill: currentColor;
            stroke: currentColor;
            animation: fav-pop .32s cubic-bezier(.2,.8,.2,1);
        }

        /* 짧은 펄스 애니메이션 */
        @keyframes fav-pop {
            0% { transform: scale(0.8); opacity: 0.6; }
            60% { transform: scale(1.12); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* 닫기 버튼: 오른쪽 상단 고정 */
        .close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 44px;
            height: 44px;
            border-radius: 10px;
            border: none;
            background: rgba(255,255,255,0.94);
            cursor: pointer;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            z-index: 40; /* 닫기 버튼을 위에 보이게 */
            box-shadow: 0 6px 18px rgba(2,6,23,0.06);
        }



        /* 모바일에서 터치 편의성 */
        @media (max-width:480px) {
            .fav-btn, .close-btn { width:52px; height:52px; border-radius:12px; }
        }
        :root{
            --bg:#f6f7f9;
            --accent:#2563eb;
            --dark:#0f172a;
            --muted:#475569;
        }
        html,body{height:100%;margin:0;font-family:"Noto Sans KR",system-ui,Arial,sans-serif;background:var(--bg);color:var(--dark);-webkit-font-smoothing:antialiased;}
        .app-header{
            position:fixed;top:0;left:0;right:0;height:64px;background:rgba(255,255,255,0.95);display:flex;align-items:center;justify-content:space-between;padding:0 20px;z-index:60;box-shadow:0 1px 0 rgba(15,23,42,0.04);
            transition:transform .28s;
        }
        .app-header.hidden{ transform: translateY(-100%); }
        .logo{ display:flex;align-items:center;gap:10px;font-weight:700;color:var(--dark); }
        .logo .mark{ width:34px;height:34px;background:var(--accent);border-radius:8px; }
        .nav-actions{ display:flex;align-items:center;gap:12px; }
        .btn{ background:var(--accent); color:#fff; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:600; }
        .btn.ghost{ background:transparent; color:var(--dark); border:1px solid rgba(15,23,42,0.06); }

        /* 히어로 */
        .hero{
            height:100vh;
            min-height:520px;
            display:flex;
            align-items:center;
            justify-content:center;
            text-align:center;
            background:linear-gradient(180deg,#bfc7cc 0%, #9aa0a4 100%);
            color:#fff;
            padding:40px 24px;
            box-sizing:border-box;
            transition:opacity .45s ease, transform .45s ease, visibility .45s;
            position:relative;
        }
        .hero.hidden{ opacity:0; transform:translateY(-10px); pointer-events:none; visibility:hidden; }
        .hero h1{ font-size:48px; line-height:1.06; margin:0 0 16px; font-weight:800; text-shadow:0 6px 20px rgba(2,6,23,0.25); }
        .hero p{ margin:0; font-size:16px; color:rgba(255,255,255,0.9); }

        /* 스크롤 힌트 */
        .scroll-hint{ position:absolute; left:50%; transform:translateX(-50%); bottom:28px; font-size:13px; color:rgba(255,255,255,0.85); display:flex;flex-direction:column;align-items:center;gap:8px;}
        .chev{ width:28px;height:28px;border-left:2px solid rgba(255,255,255,0.9); border-bottom:2px solid rgba(255,255,255,0.9); transform:rotate(-45deg); animation:swim 1.2s infinite; }
        @keyframes swim{0%{transform:translateY(0) rotate(-45deg)}50%{transform:translateY(8px) rotate(-45deg)}100%{transform:translateY(0) rotate(-45deg)}}

        /* 메인 콘텐츠 */
        main.content{ position:relative; padding:40px 24px 80px; margin-top:0; background:transparent; z-index:10; }
        .container{ max-width:1100px; margin:0 auto; }
        .section-title{ font-size:20px; margin:8px 0 18px; color:var(--dark); font-weight:700; }
        .grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:18px; }
        .place-card{ background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(2,6,23,0.06); cursor:pointer; display:flex; flex-direction:column; min-height:170px; }
        .card-thumb{ height:140px; background:linear-gradient(180deg,#e8f0ff,#f7fbff); overflow:hidden; }
        .card-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
        .card-body{ padding:12px 14px; display:flex; flex-direction:column; gap:8px; flex:1; }

        /* 콘텐츠가 아주 짧을 때 메인 영역이 화면을 채우도록 보장 */
        .content .container { min-height: calc(100vh - 64px); /* 헤더 높이 고려 */ }
        .content-footer-spacer{ height: 1px; }

        /* 모달(간단) */
        .overlay{ position:fixed; inset:0; background:rgba(2,6,23,0.45); display:none; align-items:center; justify-content:center; z-index:1100; }
        .overlay.open{ display:flex; }
        .modal{ width:min(880px,94%); background:#fff; border-radius:12px; overflow:hidden; max-height:90vh; display:flex; flex-direction:column; }
        .modal-header{ position:relative; height:200px; background:#f3f8ff; }
        .modal-body{ padding:18px; overflow:auto; }

        @media (max-width:700px){
            .hero h1{font-size:34px}
            .hero{padding:28px 18px}
            .app-header{height:56px}
        }

        /* 모달 스타일 (기존 사용하던 모달을 여기에 붙여도 됨) */
        .overlay{ position:fixed; inset:0; background:rgba(2,6,23,0.45); display:none; align-items:center; justify-content:center; z-index:1100; }
        .overlay.open{ display:flex; }
        .modal{ width:min(880px,94%); background:#fff; border-radius:12px; overflow:hidden; max-height:90vh; display:flex; flex-direction:column; }
        .modal-header{ position:relative; height:200px; background:#f3f8ff; }
        .modal-header img{ width:100%; height:100%; object-fit:cover; display:block; }
        .close-btn{ position:absolute; top:12px; right:12px; background:rgba(255,255,255,0.9); border:none; width:36px; height:36px; border-radius:8px; cursor:pointer; }
        .modal-body{ padding:18px; overflow:auto; }
        .modal-body h2{ margin:0 0 8px 0; font-size:20px; }
        .tag-area{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
        .modal .kw{ background:#f1f5f9; color:var(--dark); padding:6px 8px; border-radius:999px; }
        .modal .goodpoints li{ margin-bottom:8px; color:var(--dark); }
        .modal .visit-tip{ margin-top:12px; background:#fafafa; padding:12px; border-radius:8px; color:var(--muted); }
        body{font-family:"Noto Sans KR",Arial,sans-serif;background:#f6f7f9;color:#222;margin:0;padding:32px;}
        .container{max-width:1100px;margin:0 auto;}
        h1{text-align:center;margin-bottom:20px;font-size:26px;}
        .search-card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);display:flex;gap:10px;align-items:center;margin-bottom:22px;}
        .search-card input[type="text"]{flex:1;padding:10px 12px;border:1px solid #e6e9ee;border-radius:8px;font-size:14px;}
        .search-card button{background:#2563eb;color:#fff;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;}
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;}
        .place-card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(2,6,23,0.06);cursor:pointer;display:flex;flex-direction:column;}
        .card-thumb{height:140px;background:#eef6ff;display:flex;align-items:center;justify-content:center;overflow:hidden;}
        .card-thumb img{width:100%;height:100%;object-fit:cover;display:block;}
        .card-body{padding:12px 14px;display:flex;flex-direction:column;gap:8px;min-height:110px;}
        .place-name{font-weight:700;font-size:16px;color:#0f172a;}
        .place-intro{font-size:13px;color:#475569;line-height:1.3;min-height:36px;}
        .keywords{margin-top:auto;display:flex;gap:8px;flex-wrap:wrap;}
        .kw{font-size:12px;padding:6px 8px;border-radius:999px;background:#f1f5f9;color:#0f172a;}
        .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(10,11,12,0.55);z-index:1000;}
        .overlay.open{display:flex;}
        .modal{width:min(880px,96%);max-height:90vh;background:#fff;border-radius:12px;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 30px 60px rgba(2,6,23,0.35);}
        .modal-header{position:relative;height:220px;background:#f3f8ff;}
        .modal-header img{width:100%;height:100%;object-fit:cover;display:block;}
        .close-btn{position:absolute;top:12px;right:12px;background:rgba(255,255,255,0.85);border:none;width:36px;height:36px;border-radius:8px;cursor:pointer;font-size:16px;}
        .modal-body{padding:18px;overflow:auto;}
        .modal-body h2{margin:0 0 8px 0;font-size:20px;}
        .tag-area{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;}
        .goodpoints li{margin-bottom:8px;color:#0f172a;}
        .visit-tip{margin-top:12px;background:#fafafa;padding:12px;border-radius:8px;color:#334155;}
        @media (max-width:520px){.modal-header{height:150px}.card-thumb{height:110px}}
    </style>
</head>
<body>
<header class="app-header" id="appHeader">
    <div class="logo">
        <span class="mark"></span>
        <span>TripPick</span>
    </div>
    <nav class="nav-actions">
        <button class="btn ghost" id="btnHome">홈</button>
        <button class="btn" id="btnAsk">찜한 여행지</button>
    </nav>
</header>

<section class="hero" id="heroSection" aria-hidden="false">
    <div>
        <h1>당신만의 완벽한 여행지를<br/>찾아보세요</h1>
        <p>AI가 추천하는 맞춤형 여행지로 특별한 여행을 계획해보세요</p>
    </div>
    <div class="scroll-hint" aria-hidden="true">
        <div class="chev"></div>
        <div>아래로 스크롤하여 시작</div>
    </div>
</section>
<main>
    <div class="container">
        <h1>TripPick AI</h1>

        <form class="search-card" action="/askAI" method="post">
            <input type="text" name="area" placeholder="어느 지역으로 가시나요?" required>
            <input type="text" name="mood" placeholder="어떤 분위기를 원하세요?" required>
            <button type="submit">AI에게 물어보기</button>
        </form>

        <div>
            <h3>지역명:</h3>
            <p th:text="${area}"></p>
        </div>

        <!-- 결과 카드 그리드 -->
        <section th:if="${placeInfos != null and !#lists.isEmpty(placeInfos)}" class="grid" id="placesGrid">
            <div th:each="placeInfo : ${placeInfos}"
                 class="place-card"
                 th:attr="data-name=${placeInfo.name},
                  data-intro=${placeInfo.introduction},
                  data-visit-tip=${placeInfo.visitTip},
                  data-image=${placeInfo.imageUrl}">
                <div class="card-thumb">
                    <img th:src="${placeInfo.imageUrl}" alt="장소 이미지" onerror="this.style.display='none'">
                </div>
                <div class="card-body">
                    <div class="place-name" th:text="${placeInfo.name}">장소 이름</div>
                    <div class="place-intro" th:text="${placeInfo.introduction}">소개</div>
                    <div class="keywords">
                        <span th:each="kw : ${placeInfo.keywords}" class="kw" th:text="${kw}">키워드</span>
                    </div>

                    <!-- 숨김 DOM: JS 폴백용 -->
                    <div class="visit-tip-hidden" style="display:none" th:text="${placeInfo.visitTip}"></div>
                    <ul class="goodpoints-hidden" style="display:none">
                        <li th:each="gp : ${placeInfo.goodPoints}" th:text="${gp}">좋은 점</li>
                    </ul>
                </div>
            </div>
        </section>

        <div th:unless="${placeInfos != null and !#lists.isEmpty(placeInfos)}">
            <p>정보가 없습니다.</p>
        </div>
    </div>
</main>


<!-- 상세 모달 (즐겨찾기 버튼 추가) -->
<div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <!-- modal-header 부분 교체 -->
        <div class="modal-header" id="modalHeader">

            <!-- modal-header 안에서 닫기 버튼과 별개로 이 버튼을 왼쪽 상단에 넣으면 됩니다 -->
            <button id="favBtn" class="fav-btn" aria-pressed="false" aria-label="즐겨찾기" title="즐겨찾기">
                <svg id="favIcon" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false">
                    <!-- 빈 하트 경로와 채운 상태는 CSS에서 제어 -->
                    <path class="heart-path" d="M12 21s-7-4.634-9.064-7.01C0.879 10.78 3.06 6 7.5 6 9.59 6 12 8.06 12 8.06S14.41 6 16.5 6C20.94 6 23.121 10.78 21.064 13.99 19 16.366 12 21 12 21z"></path>
                </svg>
            </button>

            <!-- 닫기: 오른쪽 -->
            <button class="close-btn" id="closeBtn" aria-label="닫기">✕</button>
        </div>

        <div class="modal-body">
            <h2 id="modalTitle">장소 이름</h2>
            <div class="tag-area" id="modalKeywords"></div>
            <p id="modalIntro">소개</p>

            <div class="goodpoints">
                <strong>이런 점이 좋아요</strong>
                <ul id="modalGoodPoints"></ul>
            </div>

            <div class="visit-tip">
                <strong>방문 팁:</strong>
                <p id="modalVisitTip"></p>
            </div>
        </div>
    </div>
</div>

<script>
    (function initScreenTransition(){ if (window.__tripPickScreenInit) return; // 중복 방지 window.__tripPickScreenInit = true;

        document.addEventListener('DOMContentLoaded', () => { const header = document.getElementById('appHeader'); const hero = document.getElementById('heroSection'); const mainContent = document.getElementById('mainContent'); const btnHome = document.getElementById('btnHome'); const btnAsk = document.getElementById('btnAsk');


            if (btnHome) {
                btnHome.addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }

            if (btnAsk && mainContent) {
                btnAsk.addEventListener('click', () => {
                    mainContent.scrollIntoView({ behavior: 'smooth' });
                });
            }

            if (mainContent && hero) {
                const io = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            hero.classList.add('hidden');
                        } else {
                            hero.classList.remove('hidden');
                        }
                    });
                }, { threshold: 0.06 });
                io.observe(mainContent);
                // 필요하면 전역 변수로 보관: window._tripPickIO = io;
            }

// 헤더 자동 숨김(스크롤 방향)
            let lastY = window.scrollY;
            let ticking = false;
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(() => {
                        const currentY = window.scrollY;
                        if (header) {
                            if (currentY > lastY && currentY > 80) {
                                header.classList.add('hidden');
                            } else {
                                header.classList.remove('hidden');
                            }
                        }
                        lastY = currentY;
                        ticking = false;
                    });
                    ticking = true;
                }
            });

// 작은 화면 초기 상태 처리
            if (window.innerHeight < 600 && hero) {
                hero.classList.add('hidden');
            }
        }); })();
    document.addEventListener('DOMContentLoaded', function () {
        const cards = document.querySelectorAll('.place-card');
        console.log('place-card count =', cards.length);
        const overlay = document.getElementById('overlay');
        const closeBtn = document.getElementById('closeBtn');
        const modalImage = document.getElementById('modalImage');
        const modalTitle = document.getElementById('modalTitle');
        const modalKeywords = document.getElementById('modalKeywords');
        const modalIntro = document.getElementById('modalIntro');
        const modalGoodPoints = document.getElementById('modalGoodPoints');
        const modalVisitTip = document.getElementById('modalVisitTip');

        function openModal(obj) {
            if (modalImage) {
                if (obj.imageUrl) {
                    modalImage.src = obj.imageUrl;
                    modalImage.style.display = 'block';
                } else {
                    modalImage.style.display = 'none';
                    modalImage.removeAttribute('src');
                }
            }

            if (modalTitle) modalTitle.textContent = obj.name || '';
            if (modalIntro) modalIntro.textContent = obj.introduction || '';

            if (modalKeywords) {
                modalKeywords.innerHTML = '';
                (obj.keywords || []).forEach(k => {
                    const s = document.createElement('span');
                    s.className = 'kw';
                    s.textContent = k;
                    modalKeywords.appendChild(s);
                });
            }

            if (modalGoodPoints) {
                modalGoodPoints.innerHTML = '';
                (obj.goodPoints || []).forEach(gp => {
                    const li = document.createElement('li');
                    li.textContent = gp;
                    modalGoodPoints.appendChild(li);
                });
            }

            if (modalVisitTip) modalVisitTip.textContent = obj.visitTip || obj.visit_tip || obj.visit || '';

            if (overlay) {
                overlay.classList.add('open');
                overlay.setAttribute('aria-hidden', 'false');
            }
        }

        function closeModal() {
            if (overlay) {
                overlay.classList.remove('open');
                overlay.setAttribute('aria-hidden', 'true');
            }
        }

        cards.forEach(card => {
            if (card._hasModalHandler) return;
            card._hasModalHandler = true;

            card.addEventListener('click', function () {
                const obj = {};
                obj.name = card.getAttribute('data-name') || card.querySelector('.place-name')?.textContent?.trim() || '';
                obj.introduction = card.getAttribute('data-intro') || card.querySelector('.place-intro')?.textContent?.trim() || '';
                obj.imageUrl = card.getAttribute('data-image') || card.querySelector('.card-thumb img')?.src || '';
                const kwEls = card.querySelectorAll('.kw');
                obj.keywords = Array.from(kwEls).map(n => n.textContent.trim());

                const rawGood = card.getAttribute('data-goodpoints');
                if (rawGood) {
                    try {
                        obj.goodPoints = JSON.parse(rawGood);
                    } catch (e) {
                        obj.goodPoints = rawGood.split(',').map(s => s.trim()).filter(Boolean);
                    }
                } else {
                    const gpEls = card.querySelectorAll('.goodpoints-hidden li');
                    obj.goodPoints = Array.from(gpEls).map(n => n.textContent.trim());
                }

                const rawTip = card.getAttribute('data-visit-tip');
                if (rawTip) {
                    obj.visitTip = rawTip;
                } else {
                    obj.visitTip = card.querySelector('.visit-tip-hidden')?.textContent?.trim() || '';
                }

                console.log('modal obj =', obj);
                openModal(obj);
            });
        });

        if (closeBtn) closeBtn.addEventListener('click', closeModal);
        if (overlay) {
            overlay.addEventListener('click', function (e) {
                if (e.target === overlay) closeModal();
            });
        }
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && overlay && overlay.classList.contains('open')) closeModal();
        });
    });
</script>
</body>
</html>